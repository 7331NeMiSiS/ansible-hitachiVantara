apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    puma-block-service: sdi-gateway-block
  name: sdi-gateway-block
spec:
  replicas: 1
  selector:
    matchLabels:
      puma-block-service: sdi-gateway-block
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        puma-block-service: sdi-gateway-block
    spec:
      containers:
      - env:
        - name: LD_LIBRARY_PATH
          value: /opt/hitachi/puma
        - name: TZ
          value: America/Los_Angeles
        - name: _REDIS_HOST
          value: redis
        - name: _REST_SERVER_CONSOLE_LOG
          value: "true"
        - name: _REST_SERVER_LIBRARY_LOG_LEVEL
          value: verbose
        - name: _REST_SERVER_LOG_LEVEL
          value: verbose
        - name: _REST_SERVER_CERTS_DIR
          value: /var/certs
        - name: _REST_SERVER_CERT
          value: tls.crt
        - name: _REST_SERVER_KEY
          value: tls.key
        image: cpumastorage:8.6.0
        name: sdi-gateway-block
        ports:
        - containerPort: 8444
        resources: {}
        volumeMounts:
        - mountPath: /var/log
          name: sdi-gateway-block-hostpath0
        volumeDevices:
        - name: local-rw
          devicePath: /dev/sdb
      restartPolicy: Always
      volumes:
      - hostPath:
          path: /var/docker/log
        name: sdi-gateway-block-hostpath0
      - name: local-rw
        persistentVolumeClaim:
          claimName: local-pvc
